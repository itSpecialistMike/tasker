// tasker/src/components/TaskDetails.tsx
"use client";

import { useMemo } from "react";
import {
  mockTasks,
  type Task,
  type TaskStatus,
  type ApproveStatus,
} from "@/mocks/tasks";

type Props = {
  taskId: string;
};

const statusLabels: Record<TaskStatus, string> = {
  "to-do": "К выполнению",
  "in-progress": "В процессе",
  review: "На проверке",
  blocked: "Заблокирована",
  done: "Завершена",
  canceled: "Отменена",
};

const approveLabels: Record<ApproveStatus, string> = {
  "need-approval": "Требует одобрения",
  approval: "Ожидает одобрения",
  approved: "Одобрена",
  rejected: "Отклонена",
};

const formatDate = (dateString: string | null | undefined): string =>
  dateString
    ? new Date(dateString).toLocaleDateString("ru-RU", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
      })
    : "—";

export default function TaskDetails({ taskId }: Props) {
  const task: Task | undefined = useMemo(
    () => mockTasks.find((t) => t.id === taskId),
    [taskId]
  );

  if (!task) {
    return <p className="text-red-500 font-semibold">Задача не найдена.</p>;
  }

  return (
    <div className="space-y-6">
      <h1 className="text-3xl font-bold">{task.title}</h1>
      <p className="text-gray-700 text-base">{task.description}</p>

      <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-gray-600">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          height="1em"
          fill="currentColor"
          viewBox="0 0 512 512"
        >
          <path d="M 38.69767441860465 358.2015503875969 L 15.875968992248062 435.5968992248062 L 38.69767441860465 358.2015503875969 L 15.875968992248062 435.5968992248062 L 3.9689922480620154 477.27131782945736 L 3.9689922480620154 477.27131782945736 Q 0 491.16279069767444 9.922480620155039 501.08527131782944 Q 19.844961240310077 511.0077519379845 33.736434108527135 507.0387596899225 L 75.4108527131783 495.13178294573646 L 75.4108527131783 495.13178294573646 L 152.80620155038758 472.31007751937983 L 152.80620155038758 472.31007751937983 Q 168.68217054263565 467.3488372093023 181.58139534883722 457.4263565891473 L 181.58139534883722 457.4263565891473 L 181.58139534883722 457.4263565891473 L 182.57364341085272 457.4263565891473 L 182.57364341085272 457.4263565891473 Q 184.5581395348837 455.4418604651163 185.5503875968992 453.4573643410853 Q 185.5503875968992 453.4573643410853 186.54263565891472 453.4573643410853 Q 188.52713178294573 451.47286821705427 190.51162790697674 449.48837209302326 L 492.15503875968994 147.84496124031008 L 492.15503875968994 147.84496124031008 Q 508.031007751938 130.97674418604652 510.015503875969 109.14728682170542 Q 512 87.31782945736434 500.09302325581393 68.46511627906976 Q 496.1240310077519 63.50387596899225 492.15503875968994 58.542635658914726 L 452.4651162790698 18.852713178294575 L 452.4651162790698 18.852713178294575 Q 433.61240310077517 0.9922480620155039 407.8139534883721 0.9922480620155039 Q 383.0077519379845 0.9922480620155039 363.16279069767444 18.852713178294575 L 61.51937984496124 321.48837209302326 L 61.51937984496124 321.48837209302326 Q 57.55038759689923 324.4651162790698 54.57364341085271 329.4263565891473 L 53.58139534883721 329.4263565891473 L 53.58139534883721 329.4263565891473 L 53.58139534883721 329.4263565891473 L 53.58139534883721 329.4263565891473 Q 43.65891472868217 342.3255813953488 38.69767441860465 358.2015503875969 L 38.69767441860465 358.2015503875969 Z M 383.0077519379845 189.51937984496124 L 198.4496124031008 374.07751937984494 L 383.0077519379845 189.51937984496124 L 198.4496124031008 374.07751937984494 L 149.8294573643411 361.1782945736434 L 149.8294573643411 361.1782945736434 L 136.93023255813952 312.5581395348837 L 136.93023255813952 312.5581395348837 L 321.48837209302326 128 L 321.48837209302326 128 L 383.0077519379845 189.51937984496124 L 383.0077519379845 189.51937984496124 Z M 99.2248062015504 356.2170542635659 L 107.16279069767442 386.9767441860465 L 99.2248062015504 356.2170542635659 L 107.16279069767442 386.9767441860465 Q 111.13178294573643 399.8759689922481 124.03100775193798 403.84496124031006 L 154.7906976744186 411.7829457364341 L 154.7906976744186 411.7829457364341 L 147.84496124031008 422.69767441860466 L 147.84496124031008 422.69767441860466 Q 143.87596899224806 424.6821705426357 139.90697674418604 426.6666666666667 L 116.09302325581395 433.61240310077517 L 116.09302325581395 433.61240310077517 L 61.51937984496124 449.48837209302326 L 61.51937984496124 449.48837209302326 L 78.3875968992248 394.91472868217056 L 78.3875968992248 394.91472868217056 L 84.34108527131782 371.1007751937984 L 84.34108527131782 371.1007751937984 Q 86.32558139534883 367.13178294573646 88.31007751937985 363.16279069767444 L 99.2248062015504 356.2170542635659 L 99.2248062015504 356.2170542635659 Z M 315.5348837209302 217.30232558139534 Q 325.4573643410853 205.3953488372093 315.5348837209302 194.48062015503876 Q 304.62015503875966 185.5503875968992 293.70542635658916 194.48062015503876 L 198.4496124031008 289.73643410852713 L 198.4496124031008 289.73643410852713 Q 188.52713178294573 300.6511627906977 198.4496124031008 312.5581395348837 Q 209.36434108527132 321.48837209302326 220.27906976744185 312.5581395348837 L 315.5348837209302 217.30232558139534 L 315.5348837209302 217.30232558139534 Z" />
        </svg>
        <div>
          <span className="font-medium">Статус:</span>{" "}
          {statusLabels[task.status]}
        </div>
        <div>
          <span className="font-medium">Согласование:</span>{" "}
          {approveLabels[task.approveStatus]}
        </div>
        <div>
          <span className="font-medium">Создана:</span>{" "}
          {formatDate(task.createdAt)}
        </div>
        <div>
          <span className="font-medium">Дедлайн:</span>{" "}
          {formatDate(task.deadline)}
        </div>
        {task.startedAt && (
          <div>
            <span className="font-medium">Начата:</span>{" "}
            {formatDate(task.startedAt)}
          </div>
        )}
        {task.completedAt && (
          <div>
            <span className="font-medium">Завершена:</span>{" "}
            {formatDate(task.completedAt)}
          </div>
        )}
      </div>

      {task.blockedBy.length > 0 && (
        <div className="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700">
          Задача заблокирована задачами:{" "}
          <strong>{task.blockedBy.join(", ")}</strong>
        </div>
      )}
    </div>
  );
}
